---
# tasks file for tomcat

- name: Install lxml
  pip: name=lxml

- name: remove war file from temp folder
  shell: rm -rf /tmp/hello-world-war-1.0.0.war
         
- name: download war file
  maven_artifact:
    group_id: com.efsavage
    artifact_id: hello-world-war
    extension: war
    version: "{{ version }}"
    repository_url: http://54.81.106.225:8081/repository/test-release/
    username: admin
    password: admin123
    dest: "/tmp/hello-world-war-{{ version }}.war"
    mode: '0644'

- name: download tomcat server packages
  get_url:
    url: https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.71/bin/apache-tomcat-9.0.71.tar.gz
    dest: /usr/local

- name: extract tomcat packages
  unarchive:
    src: /usr/local/apache-tomcat-9.0.71.tar.gz
    dest: /usr/local
    remote_src: yes

- name: copy the war file
  copy:
    src: /tmp/hello-world-war-{{ version }}.war
    dest: /opt/apache-tomcat-9.0.71/webapps

- name: changing tomcat port number
  template:
    src: /var/lib/jenkins/workspace/AnsibleDemo/server.xml.j2
    dest: /usr/local/apache-tomcat-9.0.71/conf/server.xml
    mode: '0777'
    
  notify: restart tomcat
  
